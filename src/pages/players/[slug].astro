---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import { getClubFromRequest } from "../../utils/getClubFromRequest";

export async function getStaticPaths() {
    const players = await getCollection("players");

    return players.map((player) => ({
        params: { slug: player.slug },
    }));
}

const club = getClubFromRequest(Astro.request);
const slug = Astro.params.slug as string;

const players: CollectionEntry<"players">[] = await getCollection("players");

const player = players.find((p) => p.slug === slug && p.data.club === club);

if (!player) {
    return Astro.redirect("/404");
}
---

<BaseLayout
    title={`${player.data.name} â€“ Player Profile`}
    description={`Profile of ${player.data.name}.`}
>
    <Header />

    <main class="px-4 py-12">
        <h1 class="text-3xl font-heading uppercase">
            #{player.data.number}
            {player.data.name}
        </h1>

        <div class="aspect-3/4 bg-slate-200 dark:bg-slate-700">
            <img
                src={`${player.data.image}`}
                alt={`${player.data.name}`}
                loading="lazy"
                class="h-full w-full object-cover"
            />
        </div>

        <p class="mt-2 text-slate-600 dark:text-slate-400">
            {player.data.position}
        </p>

        <article class="prose dark:prose-invert mt-6">
            {player.body}
        </article>
    </main>

    <Footer />
</BaseLayout>
